<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Puzzle</title>
    <link rel="icon" href="WhBr-Rabbit-logo-golden-220609-v1.png" type="image/x-icon">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alice&display=swap');
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Alice', serif;
            text-align: center;
            margin: 0;
            background: #000; /* Black background */
            color: #ffa500; /* Amber text color */
        }
        .container {
            width: 100%;
            max-width: 400px;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .logo {
            width: 110px;
            height: auto;
            margin-bottom: 10px;
        }
        h1 {
            margin: 10px 0;
        }
        #game-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
            border: 2px solid #ffa500;
            border-radius: 50%;
            background: rgba(255, 165, 0, 0.1); /* Amber background */
        }
        .sun {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ffa500;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px #ffa500;
        }
        .orbit {
            position: absolute;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .orbit[data-orbit="mercury"] { width: 60%; height: 60%; border: 1px solid rgba(255, 165, 0, 0.5); }
        .orbit[data-orbit="venus"] { width: 70%; height: 70%; border: 1px solid rgba(255, 165, 0, 0.6); }
        .orbit[data-orbit="earth"] { width: 80%; height: 80%; border: 1px solid rgba(255, 165, 0, 0.7); }
        .orbit[data-orbit="mars"] { width: 85%; height: 85%; border: 1px solid rgba(255, 165, 0, 0.8); }
        .orbit[data-orbit="jupiter"] { width: 90%; height: 90%; border: 1px solid rgba(255, 165, 0, 0.9); }
        .orbit[data-orbit="saturn"] { width: 95%; height: 95%; border: 1px solid rgba(255, 165, 0, 1); }
        .planet {
            position: absolute;
            background: #ffa500;
            border-radius: 50%;
            top: 50%;
            left: 50%;
        }
        .planet[data-planet="mercury"] { width: 6px; height: 6px; transform: translate(-50%, -30px) rotate(30deg); }
        .planet[data-planet="venus"] { width: 8px; height: 8px; transform: translate(-50%, -35px) rotate(90deg); }
        .planet[data-planet="earth"] { width: 8px; height: 8px; transform: translate(-50%, -40px) rotate(150deg); }
        .planet[data-planet="mars"] { width: 7px; height: 7px; transform: translate(-50%, -42.5px) rotate(210deg); }
        .planet[data-planet="jupiter"] { width: 12px; height: 12px; transform: translate(-50%, -45px) rotate(270deg); }
        .planet[data-planet="saturn"] { width: 11px; height: 11px; transform: translate(-50%, -47.5px) rotate(330deg); }
        #move-counter {
            margin-top: 10px;
        }
        #reset-button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #reset-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="https://www.whitebranches.com/keyhole" target="_blank">
            <img src="WhBr-Rabbit-logo-golden-220609-v1.png" class="logo" alt="Logo">
        </a>
        <h1>Solar System Puzzle</h1>
        <p>Align all planets!</p>
        <div id="game-container">
            <div class="sun"></div>
            <div class="orbit" data-orbit="mercury">
                <div class="planet" data-planet="mercury"></div>
            </div>
            <div class="orbit" data-orbit="venus">
                <div class="planet" data-planet="venus"></div>
            </div>
            <div class="orbit" data-orbit="earth">
                <div class="planet" data-planet="earth"></div>
            </div>
            <div class="orbit" data-orbit="mars">
                <div class="planet" data-planet="mars"></div>
            </div>
            <div class="orbit" data-orbit="jupiter">
                <div class="planet" data-planet="jupiter"></div>
            </div>
            <div class="orbit" data-orbit="saturn">
                <div class="planet" data-planet="saturn"></div>
            </div>
        </div>
        <div id="move-counter">Moves: 0</div>
        <button id="reset-button" onclick="resetGame()">Reset</button>
        <audio id="success-sound" src="success.mp3" preload="auto"></audio>
    </div>
    <script>
        let moveCount = 0;
        let planetsAligned = false;

        function rotateOrbit(orbit, angle) {
            const currentRotation = getRotationAngle(orbit);
            orbit.style.transform = `translate(-50%, -50%) rotate(${currentRotation + angle}deg)`;
            
            // Rotate the planet in the opposite direction to keep it oriented correctly
            const planet = orbit.querySelector('.planet');
            const planetRotation = getRotationAngle(planet);
            planet.style.transform = `translate(-50%, -${orbit.offsetHeight / 2}px) rotate(${planetRotation - angle}deg)`;
        }

        function getRotationAngle(element) {
            const style = window.getComputedStyle(element);
            const transform = style.transform || style.webkitTransform || style.mozTransform;
            if (transform === 'none') return 0;
            const matrix = transform.match(/^matrix\((.+)\)$/);
            if (matrix) {
                const values = matrix[1].split(', ');
                const a = parseFloat(values[0]);
                const b = parseFloat(values[1]);
                return Math.round(Math.atan2(b, a) * (180 / Math.PI));
            }
            return 0;
        }

        function checkAlignment() {
            const planets = document.querySelectorAll('.planet');
            const angles = Array.from(planets).map(planet => {
                const orbit = planet.parentElement;
                return getRotationAngle(orbit);
            });
            const aligned = angles.every((angle, i, arr) => angle === arr[0]);
            if (aligned) {
                planetsAligned = true;
                document.getElementById('success-sound').play();
                setTimeout(() => {
                    document.body.style.transition = 'opacity 1s';
                    document.body.style.opacity = 0;
                    setTimeout(() => {
                        window.location.href = 'next.html';
                    }, 1000);
                }, 500);
            }
        }

        function onOrbitDrag(event, orbit) {
            if (planetsAligned) return;
            const startX = event.clientX || event.touches[0].clientX;
            const startY = event.clientY || event.touches[0].clientY;
            const initialAngle = getRotationAngle(orbit);

            function onMouseMove(e) {
                const currentX = e.clientX || e.touches[0].clientX;
                const currentY = e.clientY || e.touches[0].clientY;
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;
                const angle = (Math.atan2(deltaY, deltaX) * 180 / Math.PI) - 90;
                const rotationAngle = angle - initialAngle;
                rotateOrbit(orbit, rotationAngle);
                moveCount++;
                document.getElementById('move-counter').textContent = `Moves: ${moveCount}`;
                checkAlignment();
            }

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                document.removeEventListener('touchmove', onMouseMove);
                document.removeEventListener('touchend', onMouseUp);
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
            document.addEventListener('touchmove', onMouseMove);
            document.addEventListener('touchend', onMouseUp);
        }

        document.querySelectorAll('.orbit').forEach(orbit => {
            orbit.addEventListener('mousedown', (e) => onOrbitDrag(e, orbit));
            orbit.addEventListener('touchstart', (e) => onOrbitDrag(e, orbit));
        });

        function resetGame() {
            planetsAligned = false;
            moveCount = 0;
            document.getElementById('move-counter').textContent = 'Moves: 0';
            const orbits = document.querySelectorAll('.orbit');
            orbits.forEach(orbit => {
                orbit.style.transform = 'translate(-50%, -50%) rotate(0deg)';
                const planet = orbit.querySelector('.planet');
                const initialRotation = Array.from(orbits).indexOf(orbit) * 60; // 360 / 6 planets = 60 degrees
                planet.style.transform = `translate(-50%, -${orbit.offsetHeight / 2}px) rotate(${initialRotation}deg)`;
            });
        }

        resetGame();
    </script>
</body>
</html>
